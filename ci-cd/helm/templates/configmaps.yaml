{{ $app := "appConfig"}}
{{ $chartValues := dict "app-config" ( kebabcase  $app ) }}
{{ $_ := set . "chartValues" $chartValues }}

{{- $appConfigYaml := .Files.Get "configs/app-config.yaml" | fromYaml }}
{{- if not $appConfigYaml }}
  {{ fail "Failed to load app-config.yaml" }}
{{- end }}

{{- $mergeAppConfigYaml := mergeOverwrite $appConfigYaml .Values.global.config.app }}

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-app-config-map
  namespace: {{ .Release.Namespace }}
  labels:
{{ include "own-app-api.labels" . | indent 4 }}
data:
  app-config.yaml: |-
{{ toYaml $mergeAppConfigYaml | indent 4  }}
